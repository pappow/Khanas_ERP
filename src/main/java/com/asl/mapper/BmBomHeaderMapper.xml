<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.asl.mapper.BmBomMapper">

	<insert id="saveBmBomHeader" parameterType="BmBomHeader">
<!-- 		<selectKey keyProperty="xbomkey" resultType="String" order="BEFORE">
			SELECT Func_GetTrn('${zid}', '${xbomkey}', 6) FROM DUAL
		</selectKey> -->
		INSERT INTO BmBomHeader
		(   
			xbomkey,
			zemail,
			xdesc,
			xitem,
			xdiv,
			xqtybase,
			xdate,
			xpreferbatchqty,
			zid,
			zauserid,
			zuuserid,
			zaip,
			zuip,
			zactive,
			ztime,
			zutime
		)
		VALUES
		(
			#{xbomkey, jdbcType=VARCHAR},
			#{zemail, jdbcType=VARCHAR},
			#{xdesc, jdbcType=VARCHAR},
			#{xitem, jdbcType=VARCHAR},
			#{xdiv, jdbcType=VARCHAR},
			#{xqtybase, jdbcType=VARCHAR},
			#{xdate, jdbcType=DATE},
			#{xpreferbatchqty, jdbcType=INTEGER},
			#{zid, jdbcType=VARCHAR},
			#{zauserid, jdbcType=VARCHAR},
			#{zuuserid, jdbcType=VARCHAR},
			#{zaip, jdbcType=VARCHAR},
			#{zuip, jdbcType=VARCHAR},
			#{zactive, jdbcType=VARCHAR},
			#{ztime, jdbcType=TIMESTAMP},
			#{zutime, jdbcType=TIMESTAMP}
		) 
	</insert>

	<insert id="saveBmBomDetail" parameterType="BmBomDetail">
		<!-- <selectKey keyProperty="xbomkey" resultType="String" order="BEFORE">
			SELECT COUNT(*) + 1 FROM BmBomDetail WHERE xbomkey=#{xbomkey} AND zactive='1' AND zid=#{zid}
		</selectKey> -->
		INSERT INTO BmBomDetail
		(
			xbomrow,
			xbomkey,
			xstype,
			xbomcomp,
			xdesc,
			xqtymin,
			xunit,
			xwh,
			xwhdesc,
			xassembly,
			xfixedqty,
			zid,
			zauserid,
			zuuserid,
			zaip,
			zuip,
			zactive,
			ztime,
			zutime
		)
		VALUES
		(
			#{xbomkey, jdbcType=VARCHAR},
			#{xbomrow, jdbcType=INTEGER},
			#{xstype, jdbcType=VARCHAR},
			#{xbomcomp, jdbcType=VARCHAR},
			#{xdesc, jdbcType=VARCHAR},
			#{xqtymin, jdbcType=INTEGER},
			#{xunit, jdbcType=VARCHAR},
			#{xwh, jdbcType=VARCHAR},
			#{xwhdesc, jdbcType=VARCHAR},
			#{xassembly, jdbcType=VARCHAR},
			#{xfixedqty, jdbcType=VARCHAR},
			#{zid, jdbcType=VARCHAR},
			#{zauserid, jdbcType=VARCHAR},
			#{zuuserid, jdbcType=VARCHAR},
			#{zaip, jdbcType=VARCHAR},
			#{zuip, jdbcType=VARCHAR},
			#{zactive, jdbcType=VARCHAR},
			#{ztime, jdbcType=TIMESTAMP},
			#{zutime, jdbcType=TIMESTAMP}
		) 
	</insert>

	<update id="updateBmBomDetail" parameterType="BmBomDetail">
		UPDATE 
			BmBomDetail
		SET
			xstype=#{xstype, jdbcType=VARCHAR},
			xbomcomp=#{xbomcomp, jdbcType=VARCHAR},
			xdesc=#{xdesc, jdbcType=VARCHAR},
			xqtymin=#{xqtymin, jdbcType=INTEGER},
			xunit=#{xunit, jdbcType=VARCHAR},
			xwh=#{xwh, jdbcType=VARCHAR},
			xwhdesc=#{xwhdesc, jdbcType=VARCHAR},
			xassembly=#{xassembly, jdbcType=VARCHAR},
			xfixedqty=#{xfixedqty, jdbcType=VARCHAR},
			zauserid=#{zauserid, jdbcType=VARCHAR},
			zuuserid=#{zuuserid, jdbcType=VARCHAR},
			zaip=#{zaip, jdbcType=VARCHAR},
			zuip=#{zuip, jdbcType=VARCHAR},
			zactive=#{zactive, jdbcType=VARCHAR},
			ztime=#{ztime, jdbcType=TIMESTAMP},
			zutime=#{zutime, jdbcType=TIMESTAMP}
		WHERE
			xbomkey=#{xbomkey, jdbcType=INTEGER}
			AND xbomrow=#{xbomrow, jdbcType=VARCHAR}
			AND zid=#{zid, jdbcType=VARCHAR}
	</update>

	<select id="findBmBomHeaderByXbomkey" resultType="BmBomHeader">
		SELECT * FROM BmBomHeader WHERE xbomkey=#{xbomkey} AND zid=#{zid} AND zactive='1'
	</select>

	<select id="findBmBomdetailByXbomkeyAndXbomrow" resultType="BmBomDetail">
		SELECT * FROM BmBomDetail WHERE xbomkey=#{xbomkey} AND xbomrow=#{xbomrow} AND zid=#{zid} AND zactive='1'
	</select>

	<select id="findBmBomdetailByXbomkey" resultType="BmBomDetail">
		SELECT * FROM BmBomDetail WHERE xbomkey=#{xbomkey} AND zid=#{zid} AND zactive='1'
	</select>

	<select id="getAllBmBomheader" resultType="BmBomHeader">
		SELECT * FROM BmBomHeader WHERE zid=#{zid} AND zactive='1'
	</select>

</mapper>